<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infogr√°fico: TUST, TUSD e o Futuro da Energia no Brasil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- 
    Plano da Narrativa e Estrutura:
    1.  T√≠tulo e Hook: T√≠tulo forte com um dado de impacto.
    2.  Se√ß√£o 1: O Que S√£o TUST e TUSD? Explica√ß√£o simples.
    3.  Se√ß√£o 2: O Elo Perdido - Tarifas como Tributa√ß√£o Verde. Diagrama de fluxo para explicar o conceito do Poluidor-Pagador.
    4.  Se√ß√£o 3: O Modelo Brasileiro em Foco. Visualiza√ß√µes sobre descontos, subs√≠dios cruzados (ACR vs. ACL) e a Lei 14.300.
    5.  Se√ß√£o 4: Li√ß√µes do Mundo. Cards comparativos para Alemanha, UK e EUA.
    6.  Se√ß√£o 5: O Caminho a Seguir. Apresenta√ß√£o das propostas de reforma com funcionalidade de IA em modal, via backend seguro.
    7.  Footer: Fontes e conclus√£o.

    Sele√ß√£o de Visualiza√ß√µes:
    - Dado de Subs√≠dio Anual: Goal: Inform. Chosen: Single Big Number. Justification: Alto impacto para um dado chave. Method: HTML/CSS. NO SVG.
    - Desconto para Renov√°veis: Goal: Compare. Chosen: Donut Chart. Justification: Mostra claramente a propor√ß√£o do desconto. Library: Chart.js (Canvas). NO SVG.
    - Subs√≠dio Cruzado (ACR -> ACL): Goal: Compare. Chosen: HTML/CSS Diagram. Justification: Representa o fluxo de forma clara e direta. Method: HTML/CSS. NO SVG.
    - Produ√ß√£o E√≥lica por Estado: Goal: Compare/Rank. Chosen: Ordered Bar Chart. Justification: Ideal para comparar e ranquear valores entre categorias. Library: Chart.js (Canvas). NO SVG.
    - Fluxo da Tributa√ß√£o Verde: Goal: Organize. Chosen: HTML/CSS Flow Chart. Justification: Explica o processo de forma visual e sequencial. Method: HTML/CSS. NO SVG.
    - Propostas de Reforma: Goal: Organize. Chosen: HTML/CSS Grid with Unicode Icons and Gemini API integration in a modal window. Justification: Organiza as propostas e as torna interativas sem alterar o layout. Method: HTML/CSS/JS. NO SVG.
    - Comparativo Internacional: Goal: Compare. Chosen: Bar Chart. Justification: Compara a participa√ß√£o de renov√°veis entre pa√≠ses de forma eficaz. Library: Chart.js (Canvas). NO SVG.
    
    Confirma√ß√£o: NEM Mermaid JS NEM SVG foram utilizados neste documento. Todos os gr√°ficos s√£o renderizados via Canvas (Chart.js) ou constru√≠dos com HTML/CSS puro.

    Paleta de Cores Selecionada: Earthy & Energetic Transition
    -->
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f7f9f7;
            color: #1b263b;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .text-primary { color: #2d6a4f; }
        .text-secondary { color: #40916c; }
        .text-accent { color: #fca311; }
        .bg-primary { background-color: #2d6a4f; }
        .bg-secondary { background-color: #40916c; }
        .border-primary { border-color: #2d6a4f; }
        .border-accent { border-color: #fca311; }
        .gemini-result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-left: 4px solid #fca311;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #343a40;
            max-height: 60vh;
            overflow-y: auto;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #40916c;
            width: 30px;
            height: 30px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal {
            transition: opacity 0.25s ease;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-black text-primary mb-2">TUST e TUSD na Encruzilhada da Transi√ß√£o Energ√©tica</h1>
            <p class="text-lg md:text-xl text-slate-600 max-w-3xl mx-auto">Desafios e Oportunidades para a Tributa√ß√£o Verde e Inova√ß√£o no Brasil</p>
        </header>

        <main class="space-y-16">

            <section id="conceitos" class="text-center">
                <h2 class="text-3xl font-bold text-primary mb-4">O Que S√£o TUST e TUSD?</h2>
                <p class="max-w-3xl mx-auto text-slate-600 mb-8">
                    Essas siglas representam as tarifas que remuneram a infraestrutura que leva a eletricidade at√© voc√™. Pense nelas como o "ped√°gio" da energia.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div class="card text-left">
                        <h3 class="font-bold text-2xl text-secondary mb-2">TUST üõ£Ô∏è</h3>
                        <p class="font-semibold text-primary">Tarifa de Uso do Sistema de Transmiss√£o</p>
                        <p class="text-slate-600 mt-1">Cobre os custos das grandes linhas de alta tens√£o que transportam energia das usinas para as subesta√ß√µes das cidades (a "rodovia" da energia).</p>
                    </div>
                    <div class="card text-left">
                        <h3 class="font-bold text-2xl text-secondary mb-2">TUSD üèôÔ∏è</h3>
                        <p class="font-semibold text-primary">Tarifa de Uso do Sistema de Distribui√ß√£o</p>
                        <p class="text-slate-600 mt-1">Cobre os custos dos postes e fios que distribuem a energia dentro das cidades at√© as casas e empresas (as "ruas e avenidas").</p>
                    </div>
                </div>
            </section>

            <section id="tributacao-verde" class="md:col-span-2">
                <div class="card">
                    <h2 class="text-3xl font-bold text-primary mb-4 text-center">Tarifas como Ferramenta de Tributa√ß√£o Verde</h2>
                    <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">
                        A forma como a TUST e a TUSD s√£o cobradas pode ir al√©m da simples remunera√ß√£o da rede. Elas podem ser desenhadas para incentivar comportamentos sustent√°veis, aplicando o Princ√≠pio do Poluidor-Pagador.
                    </p>
                    <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8">
                        <div class="p-6 rounded-lg bg-red-50 border border-red-200 text-center w-full md:w-1/3">
                            <span class="text-4xl">üè≠</span>
                            <h4 class="font-bold text-red-800 mt-2">Fonte Poluente</h4>
                            <p class="text-red-700 text-sm">Gera externalidades negativas (emiss√µes de GEE).</p>
                        </div>
                        <div class="text-5xl text-slate-400 transform rotate-90 md:rotate-0">‚û°Ô∏è</div>
                        <div class="p-6 rounded-lg bg-yellow-50 border border-accent text-center w-full md:w-1/3">
                            <span class="text-4xl">üí∞</span>
                            <h4 class="font-bold text-primary mt-2">Paga TUST/TUSD Majorada</h4>
                            <p class="text-yellow-800 text-sm">Internaliza o custo ambiental da sua polui√ß√£o.</p>
                        </div>
                    </div>
                    <div class="flex justify-center my-4">
                        <div class="text-5xl text-slate-400">‚¨áÔ∏è</div>
                    </div>
                     <div class="flex flex-col md:flex-row justify-center items-center gap-4 md:gap-8">
                        <div class="p-6 rounded-lg bg-green-50 border border-green-200 text-center w-full md:w-1/3">
                            <span class="text-4xl">‚òÄÔ∏è</span>
                            <h4 class="font-bold text-green-800 mt-2">Fonte Renov√°vel</h4>
                            <p class="text-green-700 text-sm">Gera externalidades positivas (energia limpa).</p>
                        </div>
                        <div class="text-5xl text-slate-400 transform rotate-90 md:rotate-0">‚û°Ô∏è</div>
                        <div class="p-6 rounded-lg bg-green-100 border border-secondary text-center w-full md:w-1/3">
                            <span class="text-4xl">üìâ</span>
                            <h4 class="font-bold text-primary mt-2">Paga TUST/TUSD Reduzida</h4>
                            <p class="text-green-900 text-sm">Recebe um benef√≠cio por sua contribui√ß√£o ambiental.</p>
                        </div>
                    </div>
                    <p class="text-center text-slate-500 mt-8 text-sm max-w-2xl mx-auto">Este modelo incentiva a transi√ß√£o para uma matriz energ√©tica mais limpa, tornando a polui√ß√£o mais cara e a energia limpa mais barata.</p>
                </div>
            </section>
            
            <section id="modelo-brasileiro">
                <h2 class="text-3xl font-bold text-primary mb-8 text-center">O Modelo Brasileiro em Foco</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card md:col-span-2">
                        <h3 class="text-2xl font-bold text-secondary mb-3 text-center">O Problema do Subs√≠dio Cruzado</h3>
                         <p class="text-center text-slate-600 mb-6 max-w-3xl mx-auto">
                           Atualmente, os descontos na TUST/TUSD para geradores de fontes renov√°veis no Mercado Livre (grandes empresas) s√£o, em grande parte, custeados pelos consumidores do Mercado Cativo (residenciais e pequenos com√©rcios), gerando uma distor√ß√£o.
                        </p>
                        <div class="flex flex-col md:flex-row justify-around items-center gap-6">
                             <div class="text-center">
                                <p class="text-lg text-slate-700">Consumidores Cativos (ACR)</p>
                                <div class="text-6xl my-2">üè†</div>
                                <p class="text-sm text-slate-500">Pagam a conta do subs√≠dio</p>
                            </div>
                             <div class="text-center">
                                <div class="text-5xl text-accent font-black animate-pulse">~R$ 5 Bi</div>
                                <p class="font-bold text-primary">POR ANO</p>
                                <div class="text-5xl text-slate-400 my-2 transform rotate-90 md:rotate-0">‚û°Ô∏è</div>
                                <p class="text-sm text-slate-500">em subs√≠dios</p>
                            </div>
                             <div class="text-center">
                                <p class="text-lg text-slate-700">Geradores Renov√°veis (ACL)</p>
                                <div class="text-6xl my-2">üè¢</div>
                                <p class="text-sm text-slate-500">Recebem o benef√≠cio</p>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 text-center mt-6">Fonte: An√°lise baseada em dados de contribui√ß√µes √† ANEEL.</p>
                    </div>

                    <div class="card">
                        <h3 class="text-2xl font-bold text-secondary mb-3 text-center">Desconto para Fontes Incentivadas</h3>
                        <p class="text-center text-slate-600 mb-4">Geradores de fontes como solar e e√≥lica recebem descontos de 50% ou mais na TUST/TUSD, o que barateia seus custos de opera√ß√£o.</p>
                        <div class="chart-container h-64 md:h-80">
                            <canvas id="descontoChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="text-2xl font-bold text-secondary mb-3 text-center">Produ√ß√£o E√≥lica no Brasil</h3>
                         <p class="text-center text-slate-600 mb-4">Apesar de pol√≠ticas de incentivo, a produ√ß√£o de energia e√≥lica ainda se concentra em poucos estados, indicando que apenas benef√≠cios fiscais podem n√£o ser suficientes.</p>
                        <div class="chart-container h-64 md:h-80">
                            <canvas id="eolicaChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="licoes-mundo">
                <h2 class="text-3xl font-bold text-primary mb-8 text-center">Li√ß√µes do Mundo</h2>
                 <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">
                    Outros pa√≠ses oferecem modelos e li√ß√µes importantes sobre incentivos para energias renov√°veis. O Brasil pode aprender com seus sucessos e desafios para aprimorar suas pr√≥prias pol√≠ticas.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="card md:col-span-2">
                        <h3 class="text-2xl font-bold text-secondary mb-3 text-center">Participa√ß√£o de Renov√°veis na Matriz El√©trica (E√≥lica e Solar)</h3>
                        <p class="text-center text-slate-600 mb-4">Comparativo da participa√ß√£o de fontes e√≥lica e solar na gera√ß√£o de eletricidade, mostrando diferentes est√°gios de ado√ß√£o.</p>
                        <div class="chart-container h-80">
                             <canvas id="internationalChart"></canvas>
                        </div>
                        <p class="text-xs text-slate-400 text-center mt-4">Fonte: Dados aproximados de diversas fontes internacionais para fins ilustrativos (ex: IEA, Ember).</p>
                    </div>
                     <div class="card">
                        <h3 class="font-bold text-2xl text-secondary mb-2">üá©üá™ Alemanha</h3>
                        <p class="text-slate-600 mt-1">Pioneira com as <i>Feed-in Tariffs</i> (FiTs), garantiu pre√ßos fixos e impulsionou o mercado, mas com alto custo para os consumidores. Hoje, migrou para leil√µes, buscando mais competitividade.</p>
                        <p class="mt-3 font-bold text-primary">Li√ß√£o: Incentivos fortes no in√≠cio s√£o cruciais, mas precisam evoluir para mecanismos de mercado.</p>
                    </div>
                     <div class="card">
                        <h3 class="font-bold text-2xl text-secondary mb-2">üá¨üáß Reino Unido</h3>
                        <p class="text-slate-600 mt-1">Utiliza a <i>Smart Export Guarantee</i> (SEG) para remunerar a exporta√ß√£o de energia de pequenos geradores. Enfrenta altos custos para balancear a rede com a intermit√™ncia das renov√°veis.</p>
                        <p class="mt-3 font-bold text-primary">Li√ß√£o: √â vital considerar e gerenciar os custos de integra√ß√£o e moderniza√ß√£o da rede.</p>
                    </div>
                </div>
            </section>

            <section id="caminho-futuro">
                <h2 class="text-3xl font-bold text-primary mb-8 text-center">O Caminho a Seguir: Propostas de Reforma</h2>
                 <p class="text-center text-slate-600 mb-8 max-w-3xl mx-auto">
                    Para que a TUST e a TUSD se tornem ferramentas eficazes de Tributa√ß√£o Verde, s√£o necess√°rias reformas que alinhem os sinais econ√¥micos com os objetivos ambientais e de justi√ßa social. Use a IA para explorar os detalhes de cada proposta.
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                     <div class="card">
                        <div>
                            <h3 class="font-bold text-lg text-secondary mb-2">üí∏ Adicional por Externalidade</h3>
                            <p class="text-slate-600" data-desc="Fontes poluentes pagariam um valor extra na tarifa, refletindo o custo ambiental que geram. Alinha-se ao princ√≠pio do Poluidor-Pagador.">Fontes poluentes pagariam um valor extra na tarifa, refletindo o custo ambiental que geram. Alinha-se ao princ√≠pio do Poluidor-Pagador.</p>
                        </div>
                        <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                    <div class="card">
                        <div>
                            <h3 class="font-bold text-lg text-secondary mb-2">üìç Sinais Locacionais</h3>
                            <p class="text-slate-600" data-desc="Tarifas diferentes por regi√£o, incentivando a instala√ß√£o de usinas em locais onde a integra√ß√£o √† rede √© mais barata e eficiente.">Tarifas diferentes por regi√£o, incentivando a instala√ß√£o de usinas em locais onde a integra√ß√£o √† rede √© mais barata e eficiente.</p>
                        </div>
                        <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                    <div class="card">
                        <div>
                           <h3 class="font-bold text-lg text-secondary mb-2">‚è∞ Tarifas Vari√°veis no Tempo</h3>
                            <p class="text-slate-600" data-desc="Incentivar a inje√ß√£o de energia na rede nos hor√°rios de maior demanda (e maior custo), otimizando o uso do sistema.">Incentivar a inje√ß√£o de energia na rede nos hor√°rios de maior demanda (e maior custo), otimizando o uso do sistema.</p>
                        </div>
                         <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                    <div class="card">
                        <div>
                            <h3 class="font-bold text-lg text-secondary mb-2">‚öñÔ∏è Justi√ßa Social e Equidade</h3>
                            <p class="text-slate-600" data-desc="Criar mecanismos para que a transi√ß√£o n√£o onere desproporcionalmente os consumidores de baixa renda, garantindo uma transi√ß√£o justa.">Criar mecanismos para que a transi√ß√£o n√£o onere desproporcionalmente os consumidores de baixa renda, garantindo uma transi√ß√£o justa.</p>
                        </div>
                         <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                    <div class="card">
                        <div>
                            <h3 class="font-bold text-lg text-secondary mb-2">ü§ù Estabilidade Regulat√≥ria</h3>
                            <p class="text-slate-600" data-desc="Estabelecer regras claras e de longo prazo para atrair os investimentos massivos necess√°rios para a transi√ß√£o energ√©tica.">Estabelecer regras claras e de longo prazo para atrair os investimentos massivos necess√°rios para a transi√ß√£o energ√©tica.</p>
                        </div>
                         <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                     <div class="card">
                        <div>
                            <h3 class="font-bold text-lg text-secondary mb-2">üîå Fomento a Novas Tecnologias</h3>
                            <p class="text-slate-600" data-desc="Usar as tarifas para incentivar tecnologias habilitadoras, como sistemas de armazenamento de energia e redes inteligentes (smart grids).">Usar as tarifas para incentivar tecnologias habilitadoras, como sistemas de armazenamento de energia e redes inteligentes (smart grids).</p>
                        </div>
                         <div class="mt-4">
                            <button onclick="generateActionPlan(this)" class="w-full bg-accent text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition-colors">‚ú® Gerar Plano de A√ß√£o</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-16 pt-8 border-t border-slate-200">
            <p class="text-slate-500">Este infogr√°fico foi gerado com base no relat√≥rio de pesquisa "TUST e TUSD na Encruzilhada da Transi√ß√£o Energ√©tica: Desafios e Oportunidades para a Tributa√ß√£o Verde e Inova√ß√£o no Brasil".</p>
            <p class="text-xs text-slate-400 mt-2">Os dados apresentados s√£o para fins ilustrativos e de an√°lise, sintetizados a partir da pesquisa realizada para a disciplina "Tributa√ß√£o Verde e Inova√ß√£o Digital" da Escola de Direito do Rio de Janeiro ‚Äì FGV Direito Rio.</p>
        </footer>

    </div>

    <!-- Modal Structure -->
    <div id="actionPlanModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-60 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl w-full relative">
            <button onclick="closeModal()" class="absolute top-2 right-4 text-3xl font-light text-gray-600 hover:text-gray-900">&times;</button>
            <h3 id="modalTitle" class="text-2xl font-bold text-primary mb-4"></h3>
            <div id="modalContent"></div>
        </div>
    </div>


    <script>
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
              return label.join(' ');
            } else {
              return label;
            }
        };

        const wrapLabel = (label) => {
            const maxLength = 16;
            if (label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            words.forEach(word => {
                if ((currentLine + ' ' + word).length > maxLength) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = currentLine ? currentLine + ' ' + word : word;
                }
            });
            lines.push(currentLine);
            return lines;
        };
        
        const modal = document.getElementById('actionPlanModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');

        function closeModal() {
            modal.classList.add('hidden');
        }

        async function generateActionPlan(button) {
            const card = button.closest('.card');
            const proposalTitle = card.querySelector('h3').innerText;
            const proposalDesc = card.querySelector('p[data-desc]').dataset.desc;
            
            modalTitle.innerText = proposalTitle;
            modalContent.innerHTML = '<div class="loader"></div>';
            modal.classList.remove('hidden');
            
            button.disabled = true;

            const prompt = `Como um especialista em pol√≠ticas energ√©ticas e regulat√≥rias no Brasil, elabore um plano de a√ß√£o conciso e estruturado para a seguinte proposta:\n\nT√≠tulo: "${proposalTitle}"\nDescri√ß√£o: "${proposalDesc}"\n\nO plano deve conter:\n1.  **Primeiros Passos (3 a 4 pontos):** A√ß√µes imediatas e vi√°veis.\n2.  **Stakeholders-Chave:** Quem precisa ser envolvido (governo, ag√™ncias, setor privado, sociedade civil).\n3.  **Principais Desafios:** Obst√°culos t√©cnicos, pol√≠ticos ou econ√¥micos a serem superados.\n\nFormate a resposta em HTML simples, usando tags <ul>, <li> e <strong> para uma boa apresenta√ß√£o.`;
            
            // ATUALIZA√á√ÉO: A URL da API agora aponta para o seu backend local
            const apiUrl = '/api/generate';

            try {
                const payload = { prompt };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                   const errorData = await response.json();
                   throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                
                // A resposta da sua fun√ß√£o vem como uma string no `body`, ent√£o precisamos de fazer o parse.
                const result = JSON.parse(await response.text());

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let text = result.candidates[0].content.parts[0].text;
                    text = text.replace(/^```html\s*/, '').replace(/\s*```$/, '');
                    modalContent.innerHTML = `<div class="gemini-result">${text}</div>`;
                } else {
                    modalContent.innerHTML = `<div class="gemini-result">N√£o foi poss√≠vel gerar um plano de a√ß√£o. Tente novamente.</div>`;
                }

            } catch (error) {
                console.error('Erro ao chamar o backend:', error);
                modalContent.innerHTML = `<div class="gemini-result">Ocorreu um erro ao conectar-se ao servidor backend. Verifique se ele est√° rodando e o console para mais detalhes.</div>`;
            } finally {
                button.disabled = false;
            }
        }


        const primaryColor = '#2d6a4f';
        const secondaryColor = '#40916c';
        const accentColor = '#b7e4c7';

        
        const descontoCtx = document.getElementById('descontoChart');
        if (descontoCtx) {
            new Chart(descontoCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Custo da Tarifa Coberto', 'Desconto Aplicado'],
                    datasets: [{
                        label: 'Desconto TUST/TUSD',
                        data: [50, 50],
                        backgroundColor: [primaryColor, accentColor],
                        borderColor: '#ffffff',
                        borderWidth: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        title: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: tooltipTitleCallback
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }
        
        const eolicaCtx = document.getElementById('eolicaChart');
        if (eolicaCtx) {
            const eolicaLabels = ['Rio Grande do Norte', 'Cear√°', 'Bahia', 'Rio Grande do Sul', 'Santa Catarina', 'Para√≠ba', 'Sergipe', 'Rio de Janeiro'];
            const wrappedEolicaLabels = eolicaLabels.map(wrapLabel);
            new Chart(eolicaCtx, {
                type: 'bar',
                data: {
                    labels: wrappedEolicaLabels,
                    datasets: [{
                        label: 'Capacidade Instalada (MW)',
                        data: [1339.2, 661.0, 587.6, 460, 236.4, 69, 34.5, 28.1],
                        backgroundColor: secondaryColor,
                        borderColor: primaryColor,
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: tooltipTitleCallback
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        const internationalCtx = document.getElementById('internationalChart');
        if (internationalCtx) {
            new Chart(internationalCtx, {
                type: 'bar',
                data: {
                    labels: ['Alemanha', 'Reino Unido', 'Espanha', 'M√©dia UE', 'Brasil', 'EUA'],
                    datasets: [{
                        label: '% de E√≥lica e Solar na Gera√ß√£o El√©trica (2023, aprox.)',
                        data: [44, 33, 33, 27, 16, 16],
                        backgroundColor: ['#2d6a4f', '#40916c', '#52b788', '#95d5b2', '#fca311', '#0077b6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false,
                        },
                        title: {
                            display: false,
                        },
                        tooltip: {
                            callbacks: {
                                title: tooltipTitleCallback
                            }
                        }
                    },
                    scales: {
                        y: {
                           ticks: {
                               callback: function(value) {
                                   return value + '%';
                               }
                           }
                        }
                    }
                }
            });
        }

    </script>
</body>
</html>
```

### Como Utilizar esta Nova Estrutura

Para colocar o infogr√°fico online de forma segura com esta nova arquitetura, voc√™ precisar√° seguir estes passos:

1.  **Configurar o Ambiente Backend:**
    * Voc√™ precisar√° de um ambiente que rode Node.js (por exemplo, um servidor pr√≥prio, ou servi√ßos de hospedagem como Heroku, Vercel, Render, etc.).
    * Crie uma pasta para o seu projeto backend.
    * Salve o c√≥digo do "Backend (Node.js) para API Segura" em um arquivo chamado `server.js` (ou outro nome de sua prefer√™ncia).
    * No terminal, dentro dessa pasta, rode `npm init -y` para criar um arquivo `package.json`.
    * Instale as depend√™ncias necess√°rias: `npm install express node-fetch@2 cors dotenv`.

2.  **Proteger sua Chave de API:**
    * Na mesma pasta do backend, crie um arquivo chamado `.env`.
    * Dentro deste arquivo, adicione sua chave de API da seguinte forma:
        ```
        GEMINI_API_KEY=SUA_CHAVE_DE_API_SECRETA_VAI_AQUI
        ```
    * **Importante:** Se voc√™ usar um sistema de controle de vers√£o como o Git, adicione o arquivo `.env` ao seu `.gitignore` para nunca envi√°-lo para reposit√≥rios p√∫blicos.

3.  **Hospedar o Backend e o Frontend:**
    * **Backend:** Fa√ßa o deploy da sua pasta de backend para o servi√ßo de hospedagem escolhido. Configure a vari√°vel de ambiente `GEMINI_API_KEY` nas configura√ß√µes do seu servi√ßo de hospedagem.
    * **Frontend:** Voc√™ pode hospedar o arquivo HTML do infogr√°fico em qualquer servi√ßo de hospedagem de sites est√°ticos.
    * **Ajuste Final:** No arquivo HTML, voc√™ precisar√° alterar a linha `const apiUrl = 'http://localhost:3000/api/generate';` para a URL p√∫blica do seu backend hospedado (ex: `https://seu-backend.onrender.com/api/generate`).

Seguindo esses passos, seu infogr√°fico funcionar√° de forma segura, com a chave de API protegida no servidor, invis√≠vel para os usu√°rios fina